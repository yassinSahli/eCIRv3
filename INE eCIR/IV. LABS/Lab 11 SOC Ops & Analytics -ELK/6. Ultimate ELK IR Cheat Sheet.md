
---

# 1 — Authentication & Account Compromise

- **Brute force / repeated failed logins** (Windows):
    
    - Elastic: `event_id:4625 AND event_data.Account.keyword:* | stats count by event_data.Account, host.name | where count>50`
        
    - Splunk: `index=wineventlog EventCode=4625 | stats count by Account | where count>50`
        
- **Successful logins from new/rare source IP**:
    
    - Elastic: `event_id:4624 AND event_data.IpAddress.keyword:* | stats dc(event_data.IpAddress.keyword) as ip_count by event_data.Account.keyword | where ip_count=1`
        
    - Splunk: `index=wineventlog EventCode=4624 | stats dc(src_ip) AS ip_count BY Account | where ip_count=1`
        
- **New admin group addition (privilege escalation)**:
    
    - Elastic: `event_id:(4728 OR 4732 OR 4727) AND event_data.TargetUserName.keyword:* | table _time, event_data.TargetUserName, event_data.Group_Name`
        
- **Multiple failed then success (credential stuffing)**:
    
    - Elastic: `event_id:(4625 OR 4624) | transaction event_data.Account.keyword maxspan=5m | search eventcount>5 AND event_id:4624`
        
- **Service account login outside business hours**:
    
    - Elastic: `event_id:4624 AND event_data.Account.keyword:service_* | eval hour=hour(@timestamp) | where hour<7 OR hour>19`
        

---

# 2 — Endpoint & Process Monitoring

- **New process execution (generic)**
    
    - `event.dataset:sysmon.process_creation OR event_id:4688 | table @timestamp, host.name, process.name, process.command_line, user.name`
        
- **High-risk command lines (PowerShell encoded, download/execution)**
    
    - `process.name:powershell.exe AND process.command_line.keyword:/EncodedCommand|DownloadFile|Invoke-WebRequest/i`
        
- **Process spawn from uncommon parent (child-parent anomaly)**
    
    - `event.dataset:sysmon.process_creation | where NOT process.parent.name IN ["explorer.exe","services.exe","svchost.exe"] AND process.name IN ("cmd.exe","powershell.exe","wscript.exe")`
        
- **Unusual admin tool used remotely**
    
    - `process.name:net.exe OR process.name:sc.exe OR process.name:reg.exe | stats count by host.name, user.name, process.command_line`
        

---

# 3 — Service & Persistence

- **New service installed / service binary path outside expected locations**
    
    - `event_id:7045 AND event_data.Image.keyword:* | where NOT event_data.Image.keyword:/.*\Windows\System32\.*/i`
        
- **Scheduled task creation / modify**
    
    - `event_id:(4698 OR 4702) | table _time, host.name, event_data.TaskName, event_data.CommandLine, user.name`
        
- **Run key / startup folder manipulation**
    
    - `event_id:4657 OR event_id:4663 AND (event_data.ObjectName.keyword:/Run\/i OR event_data.ObjectName.keyword:/Startup/)`
        
- **WMI persistence / suspicious WMI namespace activity**
    
    - `process.name:wmiprvse.exe AND process.command_line.keyword:/__EventFilter|__FilterToConsumerBinding|__EventConsumer/i`
        

---

# 4 — Privilege Escalation via Services / ACLs

- **Weak service DACLs — Everyone / Authenticated Users / BUILTIN**
    
    - `event_id:(7045 OR 4697) AND (event_data.Descriptor.keyword:/Everyone/i OR event_data.Descriptor.keyword:/S-1-1-0/ OR event_data.Descriptor.keyword:/Authenticated Users/i)`
        
- **Service binary replaced or updated**
    
    - `event.dataset:sysmon.file_write | search file.path.keyword:/.*\System32\.*service.*\.exe/ AND NOT process.name:trusted_updater.exe`
        
- **Unusual service start by non-standard account**
    
    - `event_id:7036 AND event_data.ServiceAccount.keyword:* | where event_data.ServiceAccount.keyword NOT IN ("LocalSystem","NT AUTHORITY\SYSTEM")`
        

---

# 5 — Code Injection / Process Hollowing / DLL Side-loading

- **CreateRemoteThread / NtCreateThreadEx indicators (Sysmon)**
    
    - `event_id:8 OR event_id:9 | table @timestamp, host.name, process.name, process.command_line, event_data.TargetImage`
        
- **Process Access requesting full rights to LSASS/explorer**
    
    - `event_id:10 AND event_data.TargetImage.keyword:/.*\lsass.exe$/i AND event_data.AccessMask.keyword:/.*(0x1F0FFF|PROCESS_ALL_ACCESS).*/i`
        
- **Suspicious DLL loaded into high-value process (non-Microsoft signer)**
    
    - `event_id:7 AND event_data.Image.keyword:/.*\(lsass|explorer|svchost)\.exe$/i AND NOT event_data.Signer.keyword:/.*Microsoft.*/i`
        
- **Child process with hollowing patterns (suspicious PE writes into target)**
    
    - `combined: event_id:10 OR event_id:11 OR event_id:8 | where process.executable_write==true AND target.process==true`
        

---

# 6 — LSASS & Credential Theft

- **LSASS handle access**
    
    - `event_id:10 AND event_data.TargetImage.keyword:/.*\lsass.exe$/i | stats count by process.name, process.command_line, user.name`
        
- **Mimikatz / credential-dump detection**
    
    - `process.command_line.keyword:/mimikatz|sekurlsa|logonpasswords|lsa|sekurlsa::/i`
        
- **Mini-dump creation of LSASS**
    
    - `event.dataset:file_events | search file.name:"*.dmp" AND file.path.keyword:/.*\lsass.*|Local\*\*/i`
        

---

# 7 — Session Hijacking & Lateral Movement

- **RDP / SMB lateral movement patterns**
    
    - `network.destination.port:3389 OR network.destination.port:445 | stats count by source.ip, destination.ip | where count>10`
        
- **Pass-the-Hash / NTLM relay detection (sudden auth using NTLM)**
    
    - `event_id:4624 AND event_data.AuthenticationPackage.keyword:/NTLM/i | stats count by event_data.IpAddress, event_data.Account`
        
- **Concurrent logons for same LogonId or reused LogonId across hosts**
    
    - `event_id:4624 | stats dc(host.name) as host_count by event_data.LogonId | where host_count>1`
        

---

# 8 — File & System Integrity / Ransomware

- **Mass file rename / new suspicious extensions**
    
    - `event.dataset:file_events | regex file.path.keyword=".*\.(locked|crypted|encrypted|crypt)$" | stats count by host.name, user.name`
        
- **Executable in Temp or Downloads**
    
    - `event_id:11 AND file.path.keyword:/.*\(Temp|Downloads)\.*\.exe$/i`
        
- **Unexpected backup / shadow copy deletion attempts**
    
    - `process.command_line.keyword:/vssadmin|wbadmin|diskshadow|bcdedit|schtasks delete/i`
        

---

# 9 — Network / C2 / Beaconing

- **Beaconing (regular, small periodic connections)**
    
    - `network.direction:outbound | bin @timestamp span=5m | stats count by source.ip, destination.ip | where count>20`
        
- **Data exfil (large outbound)**
    
    - `network.bytes_out: * | stats sum(network.bytes_out) as bytes by source.ip | where bytes>100000000`
        
- **DNS tunnelling / suspicious domains**
    
    - `dns.question.name.keyword:/[a-z0-9]{20,}\./i | stats count by dns.question.name`
        

---

# 10 — IOC & Threat Intel Enrichment

- **IOC lookup across logs**
    
    - `(_exists_:source.ip OR _exists_:file.hash) AND (source.ip: [input_lookup.ip] OR file.hash: [input_lookup.hash])`
        
- **YARA / hash matches**
    
    - `event.dataset:file_events | lookup malware_hashes hash AS file.hash OUTPUT threat_name | where isnotnull(threat_name)`
        

---

# 11 — Triage, Prioritisation & False Positive Reduction

- **Score by asset criticality**: enrich host.name with `asset.criticality` and multiply severity by `criticality` to triage.
    
- **Whitelist common admin tools**: maintain an allowlist for management tools (e.g., SCCM, Intune, AV updaters) via a lookup and `AND NOT` clauses.
    
- **Aggregate noise sources**: group by `process.name`, `user.name`, `host.name` and set dynamic thresholds per host baseline.
    

---

## Appendix: Field mapping examples (adapt to your stack)

- Process execution: `event.dataset:sysmon.process_creation` → fields `process.name`, `process.command_line`, `process.parent.name`, `user.name`, `host.name`.
    
- File events: `event.dataset:sysmon.file_events` → `file.path`, `file.hash`, `file.signer`.
    
- Network: `network.*` fields for `src_ip`, `dest_ip`, `dest_port`, `bytes`.
    

---
