### Vulnerability Finding: HTTPS — SSL/TLS Renegotiation Abuse (Renegotiation DoS)

**Capture / Lab File:** ``SSL_renegotiation.pcap
**Date Identified:** 29/09/2025  
**Analyst:** Mr. Yassine SAHLI

---

## Description

Traffic analysis reveals an abnormal pattern of repeated **ClientHello** messages initiating new TLS handshakes without exchanging application data between handshakes. After initial handshake completion, additional `ClientHello` sequences appear repeatedly, forcing the server to perform expensive cryptographic operations (ServerHello, Certificate, Key Exchange). This behavior is consistent with an **SSL/TLS renegotiation attack** where the attacker repeatedly triggers renegotiations — causing CPU/resource exhaustion on the server.

The server's reaction (stopping abusive sessions) and multiple successive handshakes with no app data strongly indicate malicious renegotiation abuse rather than legitimate certificate renegotiation.

---

## Impact

- **Denial of Service (CPU-bound):** Repeated handshakes can exhaust server CPU and TLS resources, leading to degraded service or outage.  
- **Resource exhaustion at scale:** Multiple clients or distributed sources can amplify impact.  
- **Potential for session disruption:** Legitimate sessions may be disrupted when server resources are stressed.

Overall risk: **Medium–High** (higher if attack is volumetric/distributed).

---

## Evidence

1. Multiple `ClientHello` packets initiating new handshakes consecutively without application data exchanged.  
   ![[Pasted image 20250929113211.png]] ![[Pasted image 20250929113832.png]]

2. Server performing repeated ServerHello/Certificate/KeyExchange steps and subsequently closing/limiting session.  
   ![[Pasted image 20250929110643.png]] ![[Pasted image 20250929110723.png]]

3. Observation of server-side resource reaction (session termination / throttling).  
   ![[Pasted image 20250929113242.png]]

---

## MITRE ATT&CK Mapping

- **Impact** — **T1499** (Endpoint DoS) — specifically resource exhaustion via cryptographic handshake abuse.  
- **Command and Control / Resource Hijacking** — **T1529** (Steal or Hijack Account/Service Resources) — attacker forces resource consumption.

---

## Recommendation

**Immediate**
- Implement rate limiting / connection throttling on TLS handshake attempts at load balancers or reverse proxies.  
- Temporarily drop or throttle repeated ClientHello sequences from offending IPs.

**Remediation**
- Disable TLS renegotiation entirely on servers or configure to require client authentication for renegotiations if supported and safe for application.  
- Upgrade TLS libraries (OpenSSL, SChannel) to versions that include protections against renegotiation abuse and ensure secure defaults.  
- Configure timeouts and handshake limits per client on frontend devices (WAF, LB).

**Detection / Hardening**
- Alert on repeated ClientHello frequency per client IP or per session, and on successive handshakes without application data.  
- Ensure load balancers/proxies terminate TLS where possible and implement handshake rate-limiting.  
- Monitor server CPU usage correlated with TLS handshake spikes.

---

**Severity:** Medium–High  
**CVSSv3.1 Score (approx):** 7.0 (High for availability impact when exploited)

---

## Overall Actions & Next Steps (network-level)

1. **Containment**
   - Block identified malicious IPs (ptunnel endpoints, sqlmap sources, SMB enumerators, renegotiation sources) at the perimeter and internal segmentation points.  
   - Apply egress restrictions to reduce covert channels (ICMP filtering / inspection, restrict unnecessary outbound services).

2. **Evidence Collection**
   - Preserve pcap(s), server logs, WAF/proxy logs, and endpoint telemetry (EDR/Velociraptor/GRR) for forensic analysis. Capture memory from compromised endpoints if in-scope.

3. **Hunt & Remediate**
   - Hunt for matches to IOCs: `0xD5200880` in ICMP, connections to `10.100.11.250` (if still relevant), `sqlmap` User-Agents, NULL-session SMB probes, and repeated TLS ClientHello spikes.  
   - Remediate affected hosts (clean or re-image), rotate credentials if compromised, and enforce MFA on sensitive accounts.

4. **Strengthening**
   - Deploy IDS/IPS signatures for ptunnel/ICMP magic, SQLi patterns & sqlmap UA, SMB NULL-session attempts, and TLS-handshake abuse.  
   - Harden servers (WAF, parameterized SQL, App hardening), enforce least-privilege SMB and network segmentation, and centralize logging/alerting.

---
