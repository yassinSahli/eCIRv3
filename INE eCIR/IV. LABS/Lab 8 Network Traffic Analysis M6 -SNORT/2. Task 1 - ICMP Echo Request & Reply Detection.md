### Vulnerability Finding: ICMP Echo Request/Reply Detection via Snort

1. IR Report -P3  ICMP Detection (Echo Request / Reply)
**Capture / Lab File:** `icmp.pcap`  
**Date Identified:** 07/10/2025  
**Analyst:** Mr. Yassine SAHLI

---

## Description

Analysis of the provided `icmp.pcap` file shows ICMP traffic directed towards the protected network subnet `192.168.1.0/24`. To detect this traffic, a Snort rule was introduced in `local.rules` that triggers alerts for **ICMP Echo Requests (ping) and Echo Replies**.  

The rule is as follows:
```
alert icmp any any -> $HOME_NET any (msg: "ICMP test"; sid:1000001; rev:1; classtype:icmp-event;)
```

- **alert** — Snort action to generate an alert on match  
- **icmp** — Protocol inspected (IPv4 ICMP)  
- **any any** — Any source IP and port  
- **$HOME_NET any** — Any destination port within the home subnet (`192.168.1.0/24`)  
- **msg: "ICMP test"** — Alert message displayed  
- **sid:1000001** — Unique Snort rule identifier (above reserved range)  
- **rev:1** — Rule revision number  
- **classtype:icmp-event** — Rule classification for ICMP events  

After introducing the rule, the Snort rule set was updated using `sudo rule-update` and tested by replaying the `icmp.pcap` file towards the monitored interface with:

``# sudo tcpreplay -t -i eth0 PCAPs/icmp.pcap

Alerts were verified via the Squert web UI and also through console output using:

``# sudo snort -q -A console --daq pcap -c /etc/nsm/securityonion-eth0/snort.conf -r PCAPs/icmp.pcap


---

## Impact

- **Network reconnaissance detection:** Alerts on ICMP Echo requests help identify ping sweeps and basic network scanning attempts.  
- **Threat visibility:** Detection of ICMP traffic allows SOC analysts to correlate potential lateral movement or reconnaissance activities.  
- **Policy enforcement:** Enables enforcement of network usage policies and prevents unnoticed ICMP probing from external hosts.

Overall risk: **Medium** — ICMP traffic is often benign, but monitoring is critical to detect potential pre-attack activities.

---

## Evidence

1. Snort rule in `local.rules` triggering on ICMP Echo requests/replies.  
   ![[Pasted image 20251007165403.png]]  

2. Rule-update output confirming ruleset refresh.  
   ![[Pasted image 20251007164800.png]]  

3. Tcpreplay output showing ICMP packets being replayed to eth0.  
   ![[Pasted image 20251007165026.png]]  

4. Alerts visible in Squert web UI and console output.  
   ![[Pasted image 20251007170306.png]] ![[Pasted image 20251007165847.png]]  

---

## MITRE ATT&CK Mapping

- **Reconnaissance** — **T1595** (Active Scanning: Network Scanning)  
- **Discovery** — **T1046** (Network Service Scanning)  
- **Defense Evasion** — **T1070.004** (Indicator Removal on Host: File Deletion / Log Cleaning) — indirectly if ICMP detection is not enforced

---

## Recommendation

**Immediate**
- Ensure the Snort rule is active and triggers alerts for all ICMP Echo requests/replies targeting `$HOME_NET`.  
- Monitor alerts in real-time and investigate suspicious sources performing excessive ICMP scans.

**Remediation**
- Block or rate-limit ICMP from untrusted external sources at perimeter firewalls if ICMP abuse is observed.  
- Correlate ICMP events with other network logs to detect broader reconnaissance campaigns.

**Detection / Hardening**
- Maintain and regularly update Snort rules to capture new ICMP-based scanning techniques.  
- Combine ICMP detection with other IDS rules (TCP/UDP scans, malformed packets) to build a comprehensive network monitoring strategy.  
- Document and baseline expected ICMP traffic to reduce false positives.

---

**Severity:** Medium  
**CVSSv3.1 Score (approx):** 5.5 (Medium — reconnaissance detection without immediate compromise)
