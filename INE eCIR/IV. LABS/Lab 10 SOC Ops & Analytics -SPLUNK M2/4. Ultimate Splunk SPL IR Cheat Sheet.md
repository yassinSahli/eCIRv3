# Authentication & Account Compromise
- **Failed Logins**: `index=wineventlog EventCode=4625 | stats count by Account, src_ip`
- **Successful Logins from Unusual Locations**: `index=wineventlog EventCode=4624 | stats count by Account, src_ip, ComputerName | where src_ip!="trusted_network_range"`
- **Disabled/Locked Accounts**: `index=wineventlog EventCode=4740 OR EventCode=4725 | table _time, Account, src_ip`
- **Privilege Escalation (User added to Admin Groups)**: `index=wineventlog EventCode=4728 OR EventCode=4732 | table _time, Account, Group_Name`
- **Multiple Failed Logins Then Success (Brute Force)**: `index=wineventlog EventCode=4625 OR EventCode=4624 | transaction Account maxspan=5m | search eventcount>5 AND EventCode=4624`
- **Logins Outside Business Hours**: `index=wineventlog EventCode=4624 | eval hour=strftime(_time,"%H") | where hour<7 OR hour>20`
- **Service Account Misuse (Unexpected Logins)**: `index=wineventlog EventCode=4624 Account IN [| inputlookup service_accounts.csv | fields Account] | table _time, Account, src_ip, ComputerName`
- **Password Changes by Non-Admin**: `index=wineventlog EventCode=4723 OR EventCode=4724 | table _time, Account, TargetAccount`
- **Kerberos Ticket Forging (Golden Ticket)**: `index=wineventlog EventCode=4769 | stats count by Account, TicketOptions`
- **Unusual Concurrent Logins**: `index=wineventlog EventCode=4624 | stats dc(ComputerName) as host_count by Account | where host_count>3`

# Endpoint & Process Monitoring
- **New Process Execution**: `index=wineventlog EventCode=4688 | table _time, Account, New_Process_Name, Command_Line`
- **Suspicious PowerShell / CMD Activity**: `index=wineventlog (EventCode=4104 OR EventCode=4688) | search CommandLine="*Invoke-* OR *-EncodedCommand*" | table _time, Account, Hostname, CommandLine`
- **Ransomware Indicators (Mass File Rename / Encryption Tools)**: `index=sysmon EventCode=11 ObjectName="*.locked" OR ObjectName="*.encrypted" | stats count by Hostname, Account, ObjectName`
- **Persistence via Scheduled Tasks**: `index=wineventlog EventCode=4698 OR EventCode=4702 | table _time, TaskName, Account, Hostname`
- **Registry Run Key Modification**: `index=wineventlog EventCode=4657 ObjectName IN ("HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run*") | table _time, Account, ObjectName, OldValue, NewValue`
- **Suspicious Admin Tool Execution**: `index=wineventlog EventCode=4688 | search New_Process_Name IN ("net.exe","net1.exe","reg.exe","taskmgr.exe")`
- **Malware Execution by Hash**: `index=sysmon EventCode=1 | lookup malware_hashes Hash AS file_hash OUTPUT threat_name | where isnotnull(threat_name)`
- **Unexpected Script Execution (.vbs, .js, .ps1)**: `index=wineventlog EventCode=4688 | search New_Process_Name IN ("*.vbs","*.js","*.ps1")`
- **Mimikatz / Credential Dump Detection**: `index=wineventlog EventCode=4688 | search CommandLine="*sekurlsa*" OR CommandLine="*mimikatz*"`
- **Unusual Service Creation**: `index=wineventlog EventCode=4697 | table _time, ServiceName, Account, Hostname`
- **Autorun / Persistence Scripts in Startup**: `index=wineventlog EventCode=4656 ObjectName IN ("C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*")`

# Network Security & Firewall
- **Denied Connections / Firewall Spikes**: `index=firewall action=deny | timechart span=15m count`
- **Unusual Protocol/Port Use**: `index=network | stats count by src_ip, dest_ip, dest_port | where dest_port NOT IN (22,80,443,53,3389)`
- **Connections from Malicious IPs**: `index=network | lookup blacklisted_ips ip AS src_ip OUTPUT threat_level | where threat_level="high"`
- **Lateral Movement via SMB / RDP**: `index=network dest_port=445 OR dest_port=3389 | stats count by src_ip, dest_ip`
- **Data Exfiltration (Large Outbound Transfers)**: `index=network | stats sum(bytes_out) as outbound by src_ip | where outbound>100000000`
- **Suspicious DNS Requests**: `index=dns | stats count by query | lookup malware_domains domain AS query OUTPUT threat_level | where threat_level="high"`
- **Beaconing Detection (Regular Small Traffic to C2)**: `index=network | bin _time span=5m | stats count by src_ip, dest_ip | where count>10`
- **Unusual VPN Connections**: `index=network sourcetype="vpn" | stats count by user, src_ip | where count>10`
- **Multiple Hosts Accessed from Single Source**: `index=network | stats dc(dest_ip) as dest_count by src_ip | where dest_count>5`
- **Internal Lateral Movement Detection**: `index=network dest_ip IN [| inputlookup internal_hosts.csv | fields host_ip] | stats count by src_ip, dest_ip`
- **Port Scanning / Recon**: `index=network | stats count by src_ip, dest_port | where count>50`

# Web & Application Security
- **Unusual HTTP Methods**: `index=web sourcetype=access_combined | stats count by method, uri, src_ip | where method!="GET" AND method!="POST"`
- **Rare User Agents**: `index=web sourcetype=access_combined | stats count by useragent | where count < 5`
- **Web Vulnerability Scans (Admin / Login Pages)**: `index=web sourcetype=access_combined | regex uri="(?i)(/wp-login.php|/admin|/phpmyadmin|/config)" | stats count by src_ip, uri`
- **Multiple 404 Errors (Recon / Scanning)**: `index=web status=404 | stats count by src_ip, uri | where count>10`
- **SQLi / XSS Attempt Detection**: `index=web | regex uri="(?i)(union select|<script>|%3Cscript%3E)" | table _time, src_ip, uri`
- **Web Shell Detection**: `index=web | regex uri="(?i)(cmd\.php|shell\.php|webshell)" | table _time, src_ip, uri`
- **Abnormal POST Data**: `index=web | search method="POST" | stats count by src_ip, uri, post_data | where len(post_data)>1000`
- **Excessive Requests Per Minute (DoS)**: `index=web | bin _time span=1m | stats count by src_ip | where count>1000`

# File & System Integrity
- **File Creation / Modification**: `index=sysmon EventCode=11 OR EventCode=4663 | table _time, ObjectName, Account, Hostname`
- **USB / External Drive Use**: `index=wineventlog EventCode=4663 ObjectName="*Removable*" | stats count by Account, ObjectName`
- **Critical System File Changes**: `index=sysmon EventCode=4663 ObjectName IN ("/etc/passwd","/etc/shadow") | table _time, Hostname, Account, ObjectName`
- **Executable Dropped in Temp or Downloads**: `index=sysmon EventCode=11 ObjectName="*\\Temp\\*.exe" OR ObjectName="*\\Downloads\\*.exe" | table _time, Hostname, Account, ObjectName`
- **Ransomware File Extension Changes**: `index=sysmon EventCode=11 | regex ObjectName=".*\.(locked|encrypted|crypt)$" | table _time, Hostname, Account, ObjectName`
- **Critical Config Files Accessed**: `index=sysmon EventCode=4663 ObjectName IN ("C:\\Windows\\System32\\drivers\\etc\\hosts","C:\\Windows\\System32\\config\\SAM")`
- **Suspicious File Permission Changes**: `index=sysmon EventCode=4670 | table _time, ObjectName, SubjectUserName, AccessMask`

# Threat Hunting & IOC
- **Lookup for IOC (IP/Domain/Hash)**: `index=* [| inputlookup ioc_list.csv | fields indicator] | table _time, src_ip, dest_ip, file_hash, Account`
- **Abnormal Event Volume (Potential DoS or Mass Infection)**: `index=* | stats count by host | where count > avg(count)*3`
- **Rare Login Locations (Possible Compromise)**: `index=wineventlog EventCode=4624 | stats count by Account, src_ip | where count=1`
- **Same User Accessing Multiple Hosts**: `index=wineventlog EventCode=4624 | stats dc(ComputerName) as hosts by Account | where hosts>5`
- **IOC Detection in Process Command Lines**: `index=wineventlog EventCode=4688 | lookup malware_hashes Hash AS CommandLine OUTPUT threat_name | where isnotnull(threat_name)`
- **Unauthorized File Downloads / Executions**: `index=web | search uri IN (*.exe, *.zip, *.msi) | table _time, src_ip, uri`
- **Suspicious PowerShell Scripts**: `index=sysmon EventCode=4688 | search CommandLine IN ("*DownloadFile*","*Invoke-WebRequest*")`

# Cloud & SaaS Monitoring
- **Suspicious Admin API Calls (AWS / Azure)**: `index=cloud sourcetype="aws:cloudtrail" eventName IN ("CreateUser","AttachUserPolicy") | table _time, userName, eventName`
- **Failed MFA Attempts**: `index=cloud sourcetype="azure:signin" ResultType="50126" | stats count by UserPrincipalName`
- **High Data Download / Transfer**: `index=cloud sourcetype="aws:s3" | stats sum(bytesTransferred) by src_ip, bucket | where sum>100000000`
- **Suspicious Service Account Usage (Cloud)**: `index=cloud sourcetype="aws:cloudtrail" userIdentity.type="Service" | stats count by user

