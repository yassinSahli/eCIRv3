# Installation Activities on the Network

**Endpoint:** `botsv1`  
**Date Identified:** 03/10/2025  
**Tester:** Mr. Yassine SAHLI

## Description
The investigation focused on detecting signs of **malware installation** (Post-Exploitation) on the target system (`192.168.250.70`). By analyzing both `stream:http` and `suricata` events in Splunk and extracting hashes via Sysmon logs, the uploaded executable **3791.exe** was identified as a potential malware artifact.

## Impact
The installation of malware on the victim system allows the adversary to:  

- **Maintain persistence:** Executable can establish backdoors or scheduled tasks.  
- **Execute additional payloads:** Facilitates lateral movement or privilege escalation.  
- **Compromise system integrity:** Provides control over the endpoint and can exfiltrate data.

## Evidence

### Step 1: Detect Uploaded Executables via HTTP
Search for uploaded `.exe` files:

``SPL> index=botsv1 sourcetype=stream:http dest="192.168.250.70" *.exe``

![[Pasted image 20251002164213.png]]  
- `part_filename{}` field revealed the uploaded executable: **3791.exe**.

---

### Step 2: Confirm Upload via Suricata
Validate file upload using Suricata HTTP POST events:

``SPL> index=botsv1 sourcetype=suricata (dest=imreallynotbatman.com OR dest="192.168.250.70") http.http_method=POST .exe``

![[Pasted image 20251002164333.png]]  
- `fileinfo.filename` field confirms **3791.exe** was uploaded.

**Identify Attacker Source IP:**

``SPL> index=botsv1 sourcetype=suricata dest_ip="192.168.250.70" http.http_method=POST .exe``

![[Pasted image 20251002164425.png]]  
- Source IP responsible for the upload identified.

---

### Step 3: Search Logs for Filename Across Indexes
Locate related telemetry (e.g., Sysmon process creation events):

``SPL> index=botsv1 3791.exe``

![[Pasted image 20251002164513.png]]  
- Confirms process creation events associated with `3791.exe`.

---

### Step 4: Extract Hashes via Sysmon
Narrow search to Sysmon logs:

``SPL> index=botsv1 3791.exe sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational``

- Add fields: `Hashes`, `CommandLine`, `ParentCommandLine`.

Narrow to process creation events:

``SPL> index=botsv1 3791.exe sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational EventCode=1``

---

### Step 5: Extract MD5 Hash of Executable
Retrieve hash values from process creation events:

``SPL> index=botsv1 3791.exe CommandLine=3791.exe | stats values(md5)``

![[Pasted image 20251002164713.png]]  
- MD5 hash associated with `3791.exe` extracted and can be used as an IoC for VirusTotal/ThreatMiner searches.

---

### Step 6: Summary & Cyber Kill Chain Update
- **Uploaded file:** `3791.exe` (confirmed by HTTP and Suricata logs).  
- **Attacker source IP:** Identified in Suricata logs.  
- **Hashes extracted:** MD5 and other available hashes from Sysmon process events.  
- **Kill Chain Phase:** Confirms **Installation (Post-Exploitation)** phase — adversary successfully uploaded and executed a binary on the victim system.
![[Pasted image 20251002164731.png]]
---

## MITRE ATT&CK Mapping
- **T1059 – Command and Scripting Interpreter**  
  - Execution of uploaded binary on the endpoint.  
- **T1071 – Application Layer Protocol**  
  - Upload via HTTP POST to web server.  
- **T1105 – Ingress Tool Transfer**  
  - File transferred to victim for installation and execution.

## Recommendation

1. **Immediate Mitigation**
   - Quarantine the infected system and block the attacker source IP.  
   - Remove the uploaded binary (`3791.exe`) and related artifacts.

2. **Detection & Monitoring**
   - Create Splunk alerts for unusual HTTP POST uploads of executables.  
   - Monitor Sysmon events for process creation with suspicious command lines or hashes.

3. **Endpoint Hardening**
   - Apply endpoint protection to prevent execution of unknown binaries.  
   - Validate executable integrity and enforce application whitelisting.

4. **Threat Hunting**
   - Search for other uploaded files or processes with similar characteristics.  
   - Correlate extracted hashes with threat intelligence feeds (VirusTotal, ThreatMiner) to identify additional IoCs.

## Severity and CVSS

- **Severity:** High  
- **CVSS v3.1 Vector:** AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H  
- **CVSS Base Score:** 9.1 (Critical)
