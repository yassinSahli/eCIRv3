## **Objective**

Analyze the `incident_2.pcap` file using Bro logs and identify suspicious domain activity that may indicate the presence of **DGA-based malware**.

---

## **Step 1 â€“ Clean Previous Logs**(optional)

Before analyzing, clear any old logs to avoid confusion:

`rm -f *.log`

---

## **Step 2 â€“ Run Bro on the PCAP**

Execute Bro with checksum ignoring:

`bro -C -r PCAPs/incident_2.pcap local`
`cat con.log`
![[Pasted image 20250927234315.png]]


ðŸ‘‰ This will generate fresh logs such as `conn.log`, `dns.log`, `http.log`, etc.


---

## **Step 3 â€“ Inspect Connections**

Check general connection details:

`cat conn.log | bro-cut id.orig_h id.orig_p id.resp_h id.resp_p proto conn_state`

![[Pasted image 20250927234338.png]]
Observations:

- Multiple connections on **port 80 (HTTP)**.
    
- Connection states vary:
    
    - **REJ** â†’ rejected.
        
    - **S0** â†’ no reply.
        
    - **SH** â†’ half-open.
        

âš ï¸ This inconsistency is typical of malware traffic in **sandbox environments**.

---

## **Step 4 â€“ Inspect HTTP Traffic**

Examine HTTP requests for anomalies:

`cat http.log | bro-cut id.orig_h id.orig_p id.resp_h id.resp_p host uri referrer`

![[Pasted image 20250927234403.png]]
Observations:

- The **host field** looks abnormal (not standard domains).
    
- URLs do not resemble normal user activity.
    

---

## **Step 5 â€“ Inspect DNS Activity**

Review DNS queries:

`cat dns.log | bro-cut query`
![[Pasted image 20250927234423.png]]
Observations:

- Domains appear **unstructured and random-looking**.
    

---

## **Step 6 â€“ Analyze Domain Names**

1. Strip the Top-Level Domains (TLDs):
    

`cat dns.log | bro-cut query | cut -d . -f1 > stripped_domains`

2. Measure the length of each domain:
    

``for i in `cat stripped_domains`; do echo "${#i}"; done``

![[Pasted image 20250927234502.png]]
Observations:

- Many domains have lengths between **34 and 43 characters**.
    
- Normal domains are short and human-readable (e.g., `google`, `microsoft`).
    
- Random long domains are highly suspicious.
    

---

## **Step 7 â€“ Conclusion**

The traffic in `incident_2.pcap` shows **malware using a Domain Generation Algorithm (DGA)**.

- DGAs generate many pseudo-random domains.
    
- The malware queries multiple domains, hoping one will be registered by its Command & Control (C2) operator.
    
- This behavior is confirmed by the **abnormally long and random domain names**.
    

---

## **Outcome**

- Bro successfully revealed **abnormal DNS and HTTP activity**.
    
- Domain analysis confirms a **DGA-based malware infection**.
    
- This technique is widely used by botnets (e.g., Conficker, Kraken).
    

---

âœ… **Conclusion:** By leveraging Broâ€™s DNS and HTTP logs, analysts can spot **DGA malware activity** through abnormal domain lengths and randomized hostnames.