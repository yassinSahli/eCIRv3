### Vulnerability Finding: Malicious PowerShell Execution via Embedded Flash in Excel Document

**Endpoint:** `JUMPBOX.ELS-CHILD.ELS.LOCAL`  
**Date Identified:** 11/09/2025 
**Tester:** Mr. Yassine SAHLI  

---

## Description

During the assessment of the `JUMPBOX.ELS-CHILD.ELS.LOCAL` endpoint, a suspicious process `calc.exe` was observed running on the system. Although Calculator is typically benign, attackers often abuse trusted system binaries for malicious purposes through **process injection**, using them as a host for unauthorized code execution.  

Memory analysis using the **GRR Remote Memory Analysis (Rekall plugin: `ldrmodules`)** revealed that `calc.exe` had loaded `System.Management.Automation.dll`, the core PowerShell library. This behavior is indicative of **malicious PowerShell code execution** injected into a trusted process.

Further investigation into the user’s **Downloads directory** uncovered a suspicious `.xlsx` file. Upon closer inspection, the Excel file was determined to be a **ZIP archive** containing an embedded `ActiveX1.bin` file. Hex analysis revealed a **Shockwave Flash (SWF) file** inside, indicated by the magic header `FWS` and metadata confirming an Adobe Flex 4 application.  

This suggests the `.xls` file was **weaponized to exploit vulnerabilities in Adobe Flash Player**, a known attack vector for remote code execution. Opening the document likely triggered the execution of malicious PowerShell code via the injected Flash object, ultimately leveraging `calc.exe` as a host process.

---

## Impact

- **Remote Code Execution (RCE):** The attacker can execute arbitrary PowerShell scripts on the target system without the user’s knowledge.  
- **Persistence:** Use of `calc.exe` allows malicious code to persist and evade standard detection methods.  
- **Credential Theft or Lateral Movement:** PowerShell access could be leveraged to enumerate credentials, access sensitive files, or pivot to other machines in the network.  
- **Data Exfiltration:** Potential for attackers to read and exfiltrate sensitive data from the compromised host.  

This finding represents a **critical security risk**, as it allows an attacker to execute code at the context of a trusted system process, bypassing standard security controls.

---

## Evidence

1. **Suspicious process:** `calc.exe` running unexpectedly.  
2. **Memory analysis:** `System.Management.Automation.dll` loaded within `calc.exe` via GRR Rekall plugin (`ldrmodules`).  
![[Pasted image 20250911144121.png]]
3. **Suspicious download:** `.xlsx` file in user’s Downloads folder.  
![[Pasted image 20250911144211.png]]
4. **Embedded Flash object:** `ActiveX1.bin` inside `.xls`, confirmed as a SWF file (`FWS` header and Adobe Flex metadata).  
```sh
   dc:format>application/x-shockwave-flash</dc:format>
   <dc:title>Adobe Flex 4 Application</dc:title>
   <dc:description>http://www.adobe.com/products/flex</dc:description>
```

## MITRE ATT&CK Mapping

- **Initial Access**
  - **T1566.001 – Spearphishing Attachment**: The malicious `.xls` file was delivered as an attachment, luring the victim into opening it.
- **Execution**
  - **T1203 – Exploitation for Client Execution**: The Excel document contains an embedded **Shockwave Flash object** (`ActiveX1.bin`) that attempts to exploit vulnerabilities in **Adobe Flash Player** when the file is opened.

The malicious Excel document leverages **an embedded Shockwave Flash (SWF) ActiveX object** (`ActiveX1.bin`) to exploit vulnerable Flash components when opened, aligning with MITRE ATT&CK techniques **T1566.001 (Spearphishing Attachment)** for delivery and **T1203 (Exploitation for Client Execution)** for execution.

---

## Recommendation

**Immediate Response:**
- Isolate the endpoint to prevent lateral movement.  
- Terminate the malicious `calc.exe` process.  
- Quarantine and analyze the `.xls` file in a sandboxed environment.  

**Remediation:**
- Remove the malicious Excel document and any associated downloaded files.  
- Audit PowerShell logs for suspicious execution events.  
- Scan the endpoint for other indicators of compromise (IOCs) and persistence mechanisms.  

**Preventive Measures:**
- Implement strict email filtering to block malicious attachments.  
- Disable legacy Flash and ActiveX support in Office documents.  
- Enforce application whitelisting to prevent unauthorized binaries from executing PowerShell commands.  
- Train users to recognize and avoid phishing attachments.  

**Monitoring:**
- Enable advanced endpoint detection tools to monitor for abnormal process behavior, especially for trusted binaries like `calc.exe` and `notepad.exe`.  
- Periodically review user Downloads folders and execution logs for unexpected activities.

---

**Severity:** Critical  
**CVSSv3.1 Score:** 9.8 (Critical – Exploitation of RCE through user interaction)